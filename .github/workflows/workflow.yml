name: Python Poetry Build and Test

on:
  push:
    branches:
      - '*'

jobs:
  run-tests:
    runs-on: ubuntu-latest  # The type of virtual machine to use
    defaults:
        run:
            working-directory: .

    strategy:
      matrix:
        python-version:
          - 3.7
          - 3.8
          - 3.9
    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Set up Python
      uses: actions/setup-python@v2
      with:
        python-version: ${{ matrix.python-version }}

    - name: Install Poetry
      run: |
        pip install poetry
        poetry install

    - name: Run Tests
      run: |
        poetry run pytest

    - name: Upload Test Artifacts
      uses: actions/upload-artifact@v3
      with:
          name: test-artifacts
          path: test/resources/*.csv
          if-no-files-found: error
          retention-days: 14
